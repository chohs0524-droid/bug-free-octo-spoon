<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°í•œìˆ™ êµìœ¡ê³¼ì • ì„±ì·¨ê¸°ì¤€ ì‹œê°í™” & ì±—ë´‡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
        }

        #cy {
            width: 100%;
            height: 100%;
        }

        /* Custom scrollbar for chat */
        .chat-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .chat-scroll::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }

        .chat-scroll::-webkit-scrollbar-track {
            background-color: #f1f5f9;
        }
    </style>
</head>

<body class="bg-slate-50 h-screen flex overflow-hidden">

    <!-- Main Content Area (Graph) -->
    <div class="flex-1 relative flex flex-col">
        <div
            class="absolute top-4 left-4 z-10 bg-white/90 backdrop-blur p-4 rounded-xl shadow-lg border border-slate-200">
            <h1 class="text-2xl font-bold text-slate-800">êµìœ¡ê³¼ì • ì„±ì·¨ê¸°ì¤€</h1>
            <p class="text-sm text-slate-600 mt-1">ë…¸ë“œë¥¼ í´ë¦­í•˜ê±°ë‚˜ ì±—ë´‡ì—ê²Œ ë¬¼ì–´ë³´ì„¸ìš”.</p>
        </div>

        <!-- Graph Container -->
        <div id="cy" class="bg-slate-100"></div>
    </div>

    <!-- Chatbot Sidebar -->
    <div class="w-[400px] bg-white border-l border-slate-200 flex flex-col shadow-2xl z-20">
        <!-- Header -->
        <div class="p-4 border-b border-slate-100 bg-indigo-600 text-white">
            <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                </svg>
                <h2 class="font-bold text-lg">AI ì„±ì·¨ê¸°ì¤€ ë„ìš°ë¯¸</h2>
            </div>
            <p class="text-xs text-indigo-100 mt-1">ì§ˆë¬¸ ì˜ˆ: "êµ­ì–´ ì„±ì·¨ê¸°ì¤€ ì•Œë ¤ì¤˜", "[4ìˆ˜02-01] ë‚´ìš©ì´ ë­ì•¼?"</p>
        </div>

        <!-- Chat History -->
        <div id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-4 chat-scroll bg-slate-50">
            <!-- Welcome Message -->
            <div class="flex items-start gap-2.5">
                <div
                    class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0 text-indigo-600 font-bold text-xs">
                    AI</div>
                <div class="flex flex-col gap-1 max-w-[320px]">
                    <div
                        class="bg-white p-3 rounded-lg rounded-tl-none shadow-sm border border-slate-200 text-sm text-slate-700">
                        ì•ˆë…•í•˜ì„¸ìš”! êµì‚¬ë“¤ì„ ìœ„í•œ ì„±ì·¨ê¸°ì¤€ ë„ìš°ë¯¸ì…ë‹ˆë‹¤.<br>
                        ì™¼ìª½ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•˜ê±°ë‚˜ ì €ì—ê²Œ ì§ì ‘ ë¬¼ì–´ë³´ì„¸ìš”.<br>
                        <br>
                        <span class="font-semibold text-indigo-600">ì¶”ì²œ ì§ˆë¬¸:</span>
                        <ul class="list-disc list-inside mt-1 space-y-1 text-xs">
                            <li>êµ­ì–´ ì„±ì·¨ê¸°ì¤€ì€?</li>
                            <li>4í•™ë…„ ìˆ˜í•™ ë‚´ìš©ì€?</li>
                            <li>ê³¼í•™ 4í•™ë…„ ë³´ì—¬ì¤˜</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 bg-white border-t border-slate-100">
            <form id="chat-form" class="flex gap-2">
                <input type="text" id="chat-input"
                    class="flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm transition-shadow"
                    placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...">
                <button type="submit"
                    class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors font-medium text-sm">
                    ì „ì†¡
                </button>
            </form>
        </div>
    </div>

    <script>
        // Data parsed from ì„±ì·¨ê¸°ì¤€.ttl
        const data = {
            subjects: [
                { id: 'ex:Korean', label: 'êµ­ì–´', grade: '4-6í•™ë…„', color: '#3b82f6' },
                { id: 'ex:Math', label: 'ìˆ˜í•™', grade: '4í•™ë…„', color: '#10b981' },
                { id: 'ex:Science4', label: 'ê³¼í•™', grade: '4í•™ë…„', color: '#f59e0b' },
                { id: 'ex:SocialStudies6', label: 'ì‚¬íšŒ', grade: '6í•™ë…„', color: '#ef4444' }
            ],
            standards: [
                // êµ­ì–´
                { id: 'ex:Standard_12hwa01_01', code: '[12í™”ì–¸01-01]', text: 'ì–¸ì–´ë¥¼ ì¸ê°„ì˜ ì‚¶ê³¼ ê´€ë ¨ì§€ì–´ ì´í•´í•˜ê³ , êµ­ì–´ì™€ êµ­ì–´ìƒí™œì´ ì‹œê°„ì˜ íë¦„ì— ë”°ë¼ ë³€í™”í•˜ëŠ” ì–‘ìƒì„ ë¶„ì„í•œë‹¤', subject: 'ex:Korean', url: 'https://www.korean.go.kr/eng/grammar/history.jsp' },
                { id: 'ex:Standard_12hwa01_02', code: '[12í™”ì–¸01-02]', text: 'í‘œì¤€ ë°œìŒì„ ì´í•´í•˜ê³  ì •í™•í•˜ê²Œ ë°œìŒí•˜ëŠ” êµ­ì–´ìƒí™œì„ í•œë‹¤', subject: 'ex:Korean', url: 'https://www.korean.go.kr/front/pronunciation/pronunciation.jsp' },
                { id: 'ex:Standard_12hwa01_03', code: '[12í™”ì–¸01-03]', text: 'í’ˆì‚¬ì™€ ë¬¸ì¥ êµ¬ì¡°ì— ëŒ€í•œ ì§€ì‹ì„ í™œìš©í•˜ì—¬ ì–¸ì–´ ìë£Œë¥¼ ë¶„ì„í•˜ê³  ì„¤ëª…í•œë‹¤', subject: 'ex:Korean', url: 'https://kids.korean.go.kr/grammar/' },
                { id: 'ex:Standard_12hwa01_04', code: '[12í™”ì–¸01-04]', text: 'ë‹¨ì–´ì˜ ì§œì„ê³¼ ì˜ë¯¸, ë‹¨ì–´ ê°„ì˜ ì˜ë¯¸ ê´€ê³„ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì–´íœ˜ë¥¼ ì´í•´í•˜ê³  ë‹´í™”ì— ì ì ˆíˆ í™œìš©í•œë‹¤', subject: 'ex:Korean', url: 'https://www.vocabulary.com/' },
                { id: 'ex:Standard_12hwa01_05', code: '[12í™”ì–¸01-05]', text: 'ë‹´í™”ì˜ ë§¥ë½ì— ì ì ˆí•œ ì–´íœ˜ì™€ ë¬¸ë²• ìš”ì†Œë¥¼ ì„ íƒí•˜ì—¬ í™”ìì˜ íƒœë„ë¥¼ ë“œëŸ¬ë‚¸ë‹¤', subject: 'ex:Korean', url: 'https://www.korean.go.kr/front/grammar/usage.jsp' },
                { id: 'ex:Standard_12hwa01_06', code: '[12í™”ì–¸01-06]', text: 'ë‹´í™”ì˜ êµ¬ì¡°ë¥¼ ê³ ë ¤í•˜ì—¬ ì ì ˆí•œ ì–´íœ˜ì™€ ë¬¸ì¥ìœ¼ë¡œ ì‘ì§‘ì„± ìˆëŠ” ë‹´í™”ë¥¼ êµ¬ì„±í•œë‹¤', subject: 'ex:Korean', url: 'https://www.korean.go.kr/front/writing/cohesion.jsp' },
                { id: 'ex:Standard_12hwa01_07', code: '[12í™”ì–¸01-07]', text: 'ë‹¤ì–‘í•œ ìœ í˜•ì˜ ë‹´í™”ì™€ ë§¤ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì–¸ì–´ì˜ ê³µê³µì„±ì„ ì´í•´í•˜ê³  í‰ê°€í•œë‹¤', subject: 'ex:Korean', url: 'https://www.korean.go.kr/front/media/understanding.jsp' },
                { id: 'ex:Standard_12hwa01_08', code: '[12í™”ì–¸01-08]', text: 'ìì•„ ê°œë…ì´ ì˜ì‚¬ì†Œí†µ ë°©ì‹ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì¸ì‹í•˜ê³  í˜‘ë ¥ì ì¸ ê´€ê³„ í˜•ì„±ì— ì ì ˆí•œ ë°©ì‹ìœ¼ë¡œ ëŒ€í™”í•œë‹¤', subject: 'ex:Korean', url: 'https://www.korean.go.kr/front/communication/cooperation.jsp' },
                { id: 'ex:Standard_12hwa01_09', code: '[12í™”ì–¸01-09]', text: 'ì •ì œëœ ì–¸ì–´ì  í‘œí˜„ ì „ëµ ë° ì ì ˆí•œ ì¤€ì–¸ì–´ì â‹…ë¹„ì–¸ì–´ì  í‘œí˜„ ì „ëµì„ í™œìš©í•˜ì—¬ ë°œí‘œí•œë‹¤', subject: 'ex:Korean', url: 'https://www.korean.go.kr/front/presentation/techniques.jsp' },
                { id: 'ex:Standard_12hwa01_10', code: '[12í™”ì–¸01-10]', text: 'í™”ìì˜ ê³µì‹ ë ¥ì„ ì´í•´í•˜ê³  íš¨ê³¼ì ì¸ ì„¤ë“ ì „ëµì„ í™œìš©í•˜ì—¬ ì—°ì„¤í•œë‹¤', subject: 'ex:Korean', url: 'https://www.korean.go.kr/front/persuasion/speech.jsp' },

                // ìˆ˜í•™ 
                { id: 'ex:Standard_4su02_01', code: '[4ìˆ˜02-01]', text: 'ë‹¤ì–‘í•œ ë³€í™” ê·œì¹™ì„ ì°¾ì•„ ì„¤ëª…í•˜ê³ , ê·¸ ê·œì¹™ì„ ìˆ˜ë‚˜ ì‹ìœ¼ë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆë‹¤', subject: 'ex:Math', url: 'https://www.mathplayground.com/patterns.html' },
                { id: 'ex:Standard_4su02_02', code: '[4ìˆ˜02-02]', text: 'ê³„ì‚°ì‹ì˜ ë°°ì—´ì—ì„œ ê·œì¹™ì„ ì°¾ê³ , ê³„ì‚° ê²°ê³¼ë¥¼ ì¶”ì¸¡í•  ìˆ˜ ìˆë‹¤', subject: 'ex:Math', url: 'https://www.khanacademy.org/math/arithmetic' },
                { id: 'ex:Standard_4su01_05', code: '[4ìˆ˜01-05]', text: 'ë‚˜ëˆ—ì…ˆì´ ì´ë£¨ì–´ì§€ëŠ” ì‹¤ìƒí™œ ìƒí™©ê³¼ ì—°ê²°í•˜ì—¬ ë‚˜ëˆ—ì…ˆì˜ ì˜ë¯¸ë¥¼ ì•Œê³ , ê³±ì…ˆê³¼ ë‚˜ëˆ—ì…ˆì˜ ê´€ê³„ë¥¼ ì´í•´í•œë‹¤', subject: 'ex:Math', url: 'https://www.khanacademy.org/math/arithmetic/arith-review-multiply-divide' },
                { id: 'ex:Standard_4su01_06', code: '[4ìˆ˜01-06]', text: 'ë‚˜ëˆ„ëŠ” ìˆ˜ê°€ í•œ ìë¦¬ ìˆ˜ì¸ ë‚˜ëˆ—ì…ˆì˜ ê³„ì‚° ì›ë¦¬ë¥¼ ì´í•´í•˜ê³  ê·¸ ê³„ì‚°ì„ í•  ìˆ˜ ìˆìœ¼ë©°, ë‚˜ëˆ—ì…ˆì—ì„œ ëª«ê³¼ ë‚˜ë¨¸ì§€ì˜ ì˜ë¯¸ë¥¼ ì•ˆë‹¤', subject: 'ex:Math', url: 'https://www.mathsisfun.com/numbers/division.html' },
                { id: 'ex:Standard_4su01_07', code: '[4ìˆ˜01-07]', text: 'ë‚˜ëˆ„ëŠ” ìˆ˜ê°€ ë‘ ìë¦¬ ìˆ˜ì¸ ë‚˜ëˆ—ì…ˆì˜ ê³„ì‚° ì›ë¦¬ë¥¼ ì´í•´í•˜ê³  ê·¸ ê³„ì‚°ì„ í•  ìˆ˜ ìˆë‹¤', subject: 'ex:Math', url: 'https://www.khanacademy.org/math/arithmetic' },
                { id: 'ex:Standard_4su01_01', code: '[4ìˆ˜01-01]', text: 'í° ìˆ˜ì˜ í•„ìš”ì„±ì„ ì¸ì‹í•˜ë©´ì„œ 10000 ì´ìƒì˜ í° ìˆ˜ì— ëŒ€í•œ ìë¦¿ê°’ê³¼ ìœ„ì¹˜ì  ê¸°ìˆ˜ë²•ì„ ì´í•´í•˜ê³ , ìˆ˜ë¥¼ ì½ê³  ì“¸ ìˆ˜ ìˆë‹¤', subject: 'ex:Math', url: 'https://www.mathsisfun.com/numbers/place-value.html' },
                { id: 'ex:Standard_4su01_02', code: '[4ìˆ˜01-02]', text: 'ë‹¤ì„¯ ìë¦¬ ì´ìƒì˜ ìˆ˜ì˜ ë²”ìœ„ì—ì„œ ìˆ˜ì˜ ê³„ì—´ì„ ì´í•´í•˜ê³ , ìˆ˜ì˜ í¬ê¸°ë¥¼ ë¹„êµí•˜ë©° ê·¸ ë°©ë²•ì„ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤', subject: 'ex:Math', url: 'https://www.mathsisfun.com/numbers/comparing-numbers.html' },
                { id: 'ex:Standard_4su01_09', code: '[4ìˆ˜01-09]', text: 'ì–‘ì˜ ë“±ë¶„í• ì„ í†µí•˜ì—¬ ë¶„ìˆ˜ì˜ í•„ìš”ì„±ì„ ì¸ì‹í•˜ê³ , ë¶„ìˆ˜ë¥¼ ì´í•´í•˜ê³  ì½ê³  ì“¸ ìˆ˜ ìˆë‹¤', subject: 'ex:Math', url: 'https://www.mathsisfun.com/fractions.html' },
                { id: 'ex:Standard_4su01_10', code: '[4ìˆ˜01-10]', text: 'ë‹¨ìœ„ë¶„ìˆ˜, ì§„ë¶„ìˆ˜, ê°€ë¶„ìˆ˜, ëŒ€ë¶„ìˆ˜ë¥¼ ì•Œê³ , ê·¸ ê´€ê³„ë¥¼ ì´í•´í•œë‹¤', subject: 'ex:Math', url: 'https://www.mathsisfun.com/fractions.html' },
                { id: 'ex:Standard_4su01_11', code: '[4ìˆ˜01-11]', text: 'ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ë¼ë¦¬, ë‹¨ìœ„ë¶„ìˆ˜ë¼ë¦¬ í¬ê¸°ë¥¼ ë¹„êµí•˜ê³  ê·¸ ë°©ë²•ì„ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤', subject: 'ex:Math', url: 'https://www.mathsisfun.com/fractions_comparing.html' },

                // ê³¼í•™
                { id: 'ex:Standard_4gwa01_01', code: '[4ê³¼01-01]', text: 'ì¼ìƒìƒí™œì—ì„œ í˜ê³¼ ê´€ë ¨ëœ í˜„ìƒì— í¥ë¯¸ë¥¼ ê°–ê³ , ë¬¼ì²´ë¥¼ ë°€ê±°ë‚˜ ë‹¹ê¸¸ ë•Œ ë‚˜íƒ€ë‚˜ëŠ” í˜„ìƒì„ ê´€ì°°í•  ìˆ˜ ìˆë‹¤', subject: 'ex:Science4', url: 'https://www.sciencekids.co.nz/forces.html' },
                { id: 'ex:Standard_4gwa01_02', code: '[4ê³¼01-02]', text: 'ìˆ˜í‰ì¡ê¸° í™œë™ì„ í†µí•´ ë¬¼ì²´ì˜ ë¬´ê²Œë¥¼ ë¹„êµí•  ìˆ˜ ìˆë‹¤', subject: 'ex:Science4', url: 'https://www.sciencekids.co.nz/experiments/weights.html' },
                { id: 'ex:Standard_4gwa01_03', code: '[4ê³¼01-03]', text: 'ë¬´ê²Œë¥¼ ì •í™•íˆ ë¹„êµí•˜ê¸° ìœ„í•´ì„œëŠ” ì €ìš¸ì´ í•„ìš”í•¨ì„ ì•Œê³ , ì €ìš¸ì„ ì‚¬ìš©í•´ ë¬´ê²Œë¥¼ ë¹„êµí•  ìˆ˜ ìˆë‹¤', subject: 'ex:Science4', url: 'https://www.sciencekids.co.nz/experiments/scales.html' },
                { id: 'ex:Standard_4gwa01_04', code: '[4ê³¼01-04]', text: 'ì§€ë ˆ, ë¹—ë©´ê³¼ ê°™ì€ ë„êµ¬ë¥¼ ì´ìš©í•˜ë©´ ë¬¼ì²´ë¥¼ ë“¤ì–´ ì˜¬ë¦´ ë•Œ ë“œëŠ” í˜ì˜ í¬ê¸°ê°€ ë‹¬ë¼ì§ì„ ì•Œê³ , ë„êµ¬ê°€ ì¼ìƒìƒí™œì—ì„œ ì–´ë–»ê²Œ ì“°ì´ëŠ”ì§€ ì¡°ì‚¬í•˜ì—¬ ê³µìœ í•  ìˆ˜ ìˆë‹¤', subject: 'ex:Science4', url: 'https://www.sciencekids.co.nz/forces/simplemachines.html' },
                { id: 'ex:Standard_4gwa02_01', code: '[4ê³¼02-01]', text: 'ì—¬ëŸ¬ ê°€ì§€ ë™ë¬¼ì„ ê´€ì°°í•˜ì—¬ íŠ¹ì§•ì— ë”°ë¼ ë™ë¬¼ì„ ë¶„ë¥˜í•  ìˆ˜ ìˆë‹¤', subject: 'ex:Science4', url: 'https://www.nationalgeographic.com/animals/' },
                { id: 'ex:Standard_4gwa02_02', code: '[4ê³¼02-02]', text: 'ë‹¤ì–‘í•œ í™˜ê²½ì— ì„œì‹í•˜ëŠ” ë™ë¬¼ì„ ì¡°ì‚¬í•˜ì—¬ ë™ë¬¼ì˜ ìƒê¹€ìƒˆì™€ ìƒí™œ ë°©ì‹ì´ í™˜ê²½ê³¼ ê´€ë ¨ë˜ì–´ ìˆìŒì„ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤', subject: 'ex:Science4', url: 'https://kids.nationalgeographic.com/animals/habitats/' },
                { id: 'ex:Standard_4gwa02_03', code: '[4ê³¼02-03]', text: 'ë™ë¬¼ì˜ íŠ¹ì§•ì„ ì´ìš©í•˜ì—¬ ì¼ìƒìƒí™œì—ì„œ í™œìš©í•  ìˆ˜ ìˆëŠ” ìƒí™œìš©í’ˆì„ ì„¤ê³„í•˜ì—¬ í˜‘ë ¥ì ìœ¼ë¡œ ì†Œí†µí•  ìˆ˜ ìˆë‹¤', subject: 'ex:Science4', url: 'https://www.sciencekids.co.nz/projects.html' },
                { id: 'ex:Standard_4gwa03_01', code: '[4ê³¼03-01]', text: 'ì—¬ëŸ¬ ê°€ì§€ ì‹ë¬¼ì„ ê´€ì°°í•˜ì—¬ íŠ¹ì§•ì— ë”°ë¼ ì‹ë¬¼ì„ ë¶„ë¥˜í•  ìˆ˜ ìˆë‹¤', subject: 'ex:Science4', url: 'https://kids.nationalgeographic.com/plants/' },
                { id: 'ex:Standard_4gwa03_02', code: '[4ê³¼03-02]', text: 'ë‹¤ì–‘í•œ í™˜ê²½ì— ì„œì‹í•˜ëŠ” ì‹ë¬¼ì„ ì¡°ì‚¬í•˜ì—¬ ì‹ë¬¼ì˜ ìƒê¹€ìƒˆì™€ ìƒí™œ ë°©ì‹ì´ í™˜ê²½ê³¼ ê´€ë ¨ë˜ì–´ ìˆìŒì„ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤', subject: 'ex:Science4', url: 'https://www.britannica.com/science/plant-ecology' },
                { id: 'ex:Standard_4gwa03_03', code: '[4ê³¼03-03]', text: 'ì‹ë¬¼ì˜ íŠ¹ì§•ì„ ì´ìš©í•˜ì—¬ ì¼ìƒìƒí™œì—ì„œ í™œìš©í•  ìˆ˜ ìˆëŠ” ìƒí™œìš©í’ˆì„ ì„¤ê³„í•˜ì—¬ í˜‘ë ¥ì ìœ¼ë¡œ ì†Œí†µí•  ìˆ˜ ìˆë‹¤', subject: 'ex:Science4', url: 'https://www.sciencekids.co.nz/projects.html' },

                // ì‚¬íšŒ
                { id: 'ex:Standard_6sa04_01', code: '[6ì‚¬04-01]', text: 'ì„ ì‚¬ ì‹œëŒ€ì™€ ê³ ì¡°ì„ ì˜ ìœ ì ê³¼ ìœ ë¬¼ì„ í™œìš©í•˜ì—¬ ë‹¹ì‹œ ì‚¬ëŒë“¤ì˜ ìƒí™œì„ ì¶”ë¡ í•œë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.britannica.com/topic/Korea-ancient-history' },
                { id: 'ex:Standard_6sa04_02', code: '[6ì‚¬04-02]', text: 'ì—­ì‚¬ ê¸°ë¡ì´ë‚˜ ìœ ì ê³¼ ìœ ë¬¼ì— ë‚˜íƒ€ë‚œ ê³ ëŒ€ ì‚¬ëŒë“¤ì˜ ìƒê°ê³¼ ìƒí™œì„ ì¶”ë¡ í•œë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.koreanheritage.kr/' },
                { id: 'ex:Standard_6sa04_03', code: '[6ì‚¬04-03]', text: 'ë‹¤ì–‘í•œ ì—­ì‚¬ ìë£Œë¥¼ í™œìš©í•˜ì—¬ ê³ ë ¤ ì‹œëŒ€ ì‚¬íšŒ ëª¨ìŠµê³¼ ì‚¬ëŒë“¤ì˜ ìƒí™œì„ ì¶”ë¡ í•œë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.koreanheritage.kr/' },
                { id: 'ex:Standard_6sa05_01', code: '[6ì‚¬05-01]', text: 'ì¡°ì„  ì‹œëŒ€ ì‚¬ëŒë“¤ì˜ ìƒê°ê³¼ ìƒí™œì— ìœ êµ ë¬¸í™”ê°€ ë¯¸ì¹œ ì˜í–¥ì„ íŒŒì•…í•œë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.koreanheritage.kr/' },
                { id: 'ex:Standard_6sa05_02', code: '[6ì‚¬05-02]', text: 'ì¡°ì„  í›„ê¸° ì‚¬íšŒâ‹…ë¬¸í™”ì  ë³€í™”ì™€ ê°œí•­ê¸° ê·¼ëŒ€ ë¬¸ë¬¼ ìˆ˜ìš© ê³¼ì •ì—ì„œ ë‹¬ë¼ì§„ ì‚¬ëŒë“¤ì˜ ìƒí™œì„ ì´í•´í•œë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.koreanhistory.or.kr/' },
                { id: 'ex:Standard_6sa06_01', code: '[6ì‚¬06-01]', text: 'ì¼ì œì˜ ì‹ë¯¼ í†µì¹˜ì™€ ì´ì— ëŒ€í•œ ì €í•­ì´ ì‚¬íšŒì™€ ìƒí™œì— ë¯¸ì¹œ ì˜í–¥ì„ ì´í•´í•œë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.koreanhistory.or.kr/' },
                { id: 'ex:Standard_6sa06_02', code: '[6ì‚¬06-02]', text: '8Â·15 ê´‘ë³µê³¼ 6Â·25 ì „ìŸì´ ì‚¬íšŒì™€ ìƒí™œì— ë¯¸ì¹œ ì˜í–¥ì„ íŒŒì•…í•œë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.koreanhistory.or.kr/' },
                { id: 'ex:Standard_6sa07_01', code: '[6ì‚¬07-01]', text: 'ë¶„ë‹¨ìœ¼ë¡œ ë‚˜íƒ€ë‚œ ë¬¸ì œì ê³¼ ë¶„ë‹¨ê³¼ ê´€ë ¨ëœ ì¥ì†Œë¥¼ í‰í™”ì˜ ì¥ì†Œë¡œ ë§Œë“¤ë ¤ëŠ” ë…¸ë ¥ ë“±ì„ ì•Œì•„ë³´ê³ , í‰í™” í†µì¼ì„ ìœ„í•´ ìš°ë¦¬ê°€ í•  ìˆ˜ ìˆëŠ” ì¼ì„ íƒìƒ‰í•œë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.koreanpeace.or.kr/' },
                { id: 'ex:Standard_6sa07_02', code: '[6ì‚¬07-02]', text: 'ë¯¼ì£¼í™”ì™€ ì‚°ì—…í™”ë¡œ ì¸í•´ ë‹¬ë¼ì§„ ìƒí™œ ë¬¸í™”ë¥¼ ì‚¬ë¡€ë¥¼ ë“¤ì–´ ì´í•´í•œë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.koreanheritage.kr/' },
                { id: 'ex:Standard_6sa08_01', code: '[6ì‚¬08-01]', text: 'ë¯¼ì£¼ì£¼ì˜ì—ì„œ ì„ ê±°ì˜ ì˜ë¯¸ì™€ ì—­í• ì„ íŒŒì•…í•˜ê³ , ì‹œë¯¼ì˜ ì£¼ê¶Œ í–‰ì‚¬ë¥¼ ìœ„í•´ ì„ ê±°ì— ì°¸ì—¬í•˜ëŠ” íƒœë„ë¥¼ ê¸°ë¥¸ë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.niec.go.kr/' },
                { id: 'ex:Standard_6sa08_02', code: '[6ì‚¬08-02]', text: 'ë¯¼ì£¼ êµ­ê°€ì—ì„œ êµ­íšŒ, í–‰ì •ë¶€, ë²•ì›ì´ í•˜ëŠ” ì¼ì— ëŒ€í•´ ì´í•´í•˜ê³ , ê° êµ­ê°€ê¸°ê´€ì˜ ê¶Œë ¥ì„ ë¶„ë¦½í•˜ëŠ” ì´ìœ ë¥¼ íƒìƒ‰í•œë‹¤', subject: 'ex:SocialStudies6', url: 'https://www.niec.go.kr/' }
            ]
        };

        // Graph Initialization
        const cy = cytoscape({
            container: document.getElementById('cy'),
            elements: [
                ...data.subjects.map(s => ({
                    data: { id: s.id, label: s.label, type: 'subject', color: s.color }
                })),
                ...data.standards.map(s => ({
                    data: { id: s.id, label: s.code, text: s.text, type: 'standard', parent: null }
                })),
                ...data.standards.map(s => ({
                    data: { source: s.id, target: s.subject }
                }))
            ],
            style: [
                {
                    selector: 'node[type="subject"]',
                    style: {
                        'background-color': 'data(color)',
                        'label': 'data(label)',
                        'color': '#1e293b',
                        'font-size': '20px',
                        'font-weight': 'bold',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'width': 80,
                        'height': 80,
                        'border-width': 4,
                        'border-color': '#fff',
                        'shadow-blur': 10,
                        'shadow-color': 'rgba(0,0,0,0.1)'
                    }
                },
                {
                    selector: 'node[type="standard"]',
                    style: {
                        'background-color': '#ffffff',
                        'label': 'data(label)',
                        'color': '#475569',
                        'font-size': '12px',
                        'width': 60,
                        'height': 60,
                        'border-width': 2,
                        'border-color': '#cbd5e1',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'text-wrap': 'wrap',
                        'text-max-width': 50
                    }
                },
                {
                    selector: ':selected',
                    style: {
                        'border-width': 4,
                        'border-color': '#6366f1' // Indigo-500
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#e2e8f0',
                        'target-arrow-color': '#e2e8f0',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier'
                    }
                }
            ],
            layout: {
                name: 'cose',
                animate: false,
                padding: 50,
                componentSpacing: 100,
                nodeRepulsion: 4500,
            }
        });

        // Chatbot Logic
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatHistory = document.getElementById('chat-history');

        function addMessage(text, isUser = false) {
            const wrapper = document.createElement('div');
            wrapper.className = `flex items-start gap-2.5 ${isUser ? 'flex-row-reverse' : ''}`;

            const icon = document.createElement('div');
            icon.className = `w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 text-xs font-bold ${isUser ? 'bg-slate-800 text-white' : 'bg-indigo-100 text-indigo-600'
                }`;
            icon.textContent = isUser ? 'ME' : 'AI';

            const bubble = document.createElement('div');
            bubble.className = `p-3 rounded-lg shadow-sm border text-sm max-w-[320px] ${isUser
                    ? 'bg-slate-800 text-white border-transparent rounded-tr-none'
                    : 'bg-white text-slate-700 border-slate-200 rounded-tl-none'
                }`;
            bubble.innerHTML = text; // Allow HTML

            wrapper.appendChild(icon);
            wrapper.appendChild(bubble);

            chatHistory.appendChild(wrapper);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // Graph Interaction
        cy.on('tap', 'node', function (evt) {
            const node = evt.target;
            const data = node.data();

            if (data.type === 'standard') {
                addMessage(`
                    <strong>${data.label}</strong><br>
                    <p class="mt-1">${data.text}</p>
                    <a href="${node.data('url') || '#'}" target="_blank" class="text-indigo-500 hover:underline mt-2 block text-xs">ğŸŒ ì°¸ê³  ìë£Œ ë³´ê¸°</a>
                `);
            } else if (data.type === 'subject') {
                const count = cy.nodes(`[parent="${data.id}"], [subject="${data.id}"], [source="${data.id}"], [target="${data.id}"]`).length;
                // Simple connectivity check - or just count edges connected to this subject node
                const edgeCount = node.connectedEdges().length;

                addMessage(`
                    <strong>${data.label} (${data.grade || ''})</strong><br>
                    ì´ ${edgeCount}ê°œì˜ ì„±ì·¨ê¸°ì¤€ì´ ìˆìŠµë‹ˆë‹¤.
                `);
            }
        });

        function handleQuery(query) {
            const q = query.trim().toLowerCase();

            // Logic 1: Ask by Subject Name
            // "êµ­ì–´", "ìˆ˜í•™ ë³´ë ¤ì¤˜", "ê³¼í•™ ì„±ì·¨ê¸°ì¤€"
            const matchedSubject = data.subjects.find(s => q.includes(s.label));

            if (matchedSubject) {
                // Focus on graph
                const subNode = cy.$id(matchedSubject.id);
                if (subNode) {
                    cy.fit(subNode.union(subNode.connectedEdges().connectedNodes()), 50);
                    subNode.select();
                }

                const standards = data.standards.filter(s => s.subject === matchedSubject.id);
                const listHtml = standards.map(s =>
                    `<li class="hover:text-indigo-600 cursor-pointer" onclick="clickNode('${s.id}')">
                        â€¢ ${s.code}
                     </li>`
                ).join('');

                return `
                    <strong>${matchedSubject.label}</strong> ê´€ë ¨ ì„±ì·¨ê¸°ì¤€ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.<br>
                    ì´ ${standards.length}ê°œì…ë‹ˆë‹¤:<br>
                    <ul class="mt-2 space-y-1 max-h-40 overflow-y-auto">${listHtml}</ul>
                `;
            }

            // Logic 2: Search by Code
            // "[12í™”ì–¸01-01]" or "12í™”ì–¸01"
            const matchedStandard = data.standards.find(s => q.includes(s.code) || q.includes(s.code.replace(/[\[\]]/g, '')));
            if (matchedStandard) {
                clickNode(matchedStandard.id);
                return `${matchedStandard.code} ì„±ì·¨ê¸°ì¤€ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤. ê·¸ë˜í”„ì—ì„œ ê°•ì¡° í‘œì‹œí–ˆìŠµë‹ˆë‹¤.`;
            }

            // Logic 3: Search by Text Content Keywords
            const keywordMatches = data.standards.filter(s => s.text.includes(q));
            if (keywordMatches.length > 0 && q.length > 1) { // Avoid single char matching
                const listHtml = keywordMatches.map(s =>
                    `<li class="hover:text-indigo-600 cursor-pointer" onclick="clickNode('${s.id}')">
                        â€¢ ${s.code}: ${s.text.substring(0, 15)}...
                     </li>`
                ).join('');
                return `"${q}"(ì´)ê°€ í¬í•¨ëœ ì„±ì·¨ê¸°ì¤€ ${keywordMatches.length}ê°œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.<br><ul class="mt-2 space-y-1 max-h-40 overflow-y-auto">${listHtml}</ul>`;
            }

            return "ì£„ì†¡í•©ë‹ˆë‹¤. ê´€ë ¨ëœ ì„±ì·¨ê¸°ì¤€ì´ë‚˜ ê³¼ëª©ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.<br> 'êµ­ì–´', 'ìˆ˜í•™', '[4ìˆ˜01-01]' ë“±ìœ¼ë¡œ ì§ˆë¬¸í•´ë³´ì„¸ìš”.";
        }

        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const msg = chatInput.value.trim();
            if (!msg) return;

            addMessage(msg, true);
            chatInput.value = '';

            setTimeout(() => {
                const response = handleQuery(msg);
                addMessage(response);
            }, 600);
        });

        // Helper to programmatically click standard nodes from chat
        window.clickNode = function (id) {
            const node = cy.$id(id);
            if (node.length) {
                cy.fit(node, 100);
                node.select();
                node.emit('tap');
            }
        }
    </script>
</body>

</html>